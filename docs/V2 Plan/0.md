## ğŸ§± 1. Course Structure: `ibdp_math_template`

**Hierarchy**

```
Course (IBDP Mathematics)
â”‚
â”œâ”€â”€ Units (e.g., Algebra, Calculus, Probability)
â”‚   â”œâ”€â”€ Chapters (e.g., Sequences, Differentiation)
â”‚   â”‚   â”œâ”€â”€ Lessons (Concepts, Videos, Notes)
â”‚   â”‚   â””â”€â”€ Practice Sets (Adaptive, Tagged Questions)
â”‚   â””â”€â”€ Chapter Tests (Summative)
â””â”€â”€ Unit Tests / Mock Exams
```

Each node has:

- **Metadata** (title, description, difficulty weight)
- **Prerequisites**
- **Tag relevance** (concepts, skills, command terms)
- **AI Tutor availability** toggle

---

## ğŸ§  2. Question Architecture & Tag System

### Question Schema (stored in Supabase / Postgres)

| Field                   | Description                                        |
| ----------------------- | -------------------------------------------------- |
| `id`                    | Unique question ID                                 |
| `unit_id`, `chapter_id` | Hierarchy reference                                |
| `content`               | LaTeX/HTML question text                           |
| `solution`              | Hidden content revealed on click                   |
| `tags`                  | Array â€” e.g. `["derivatives", "chain_rule", "HL"]` |
| `difficulty`            | 1â€“10 scale                                         |
| `time_expected`         | Expected solving time                              |
| `source`                | Origin (IB question, past paper, custom)           |

### Tag Management

- Maintain a **Tag Master Table**:
  Each tag has:

  - `id`, `name`, `category` (Concept, Skill, Command Term)
  - `related_tags` (for question recommendations)
  - `weight` (importance level)

> ğŸ” Future: Allow teachers to merge/split tags dynamically (e.g., merging â€œChain Ruleâ€ and â€œDifferentiation â€“ Compositeâ€).

---

## ğŸ§® 3. Adaptive Question Flow

### Data Captured per Question Attempt

| Data Point            | Captured By                  |
| --------------------- | ---------------------------- |
| `student_id`          | Authentication               |
| `question_id`         | From question bank           |
| `time_taken`          | Timer start-stop             |
| `self_marked_correct` | User input                   |
| `tags`                | Auto-inherited from question |
| `timestamp`           | Auto                         |
| `session_id`          | For grouping attempts        |

### Algorithm Outline

1. **Start with median difficulty (5/10)** questions within a topic.
2. Based on:

   - Speed (fast & correct â†’ +1 difficulty)
   - Accuracy (slow or wrong â†’ -1 difficulty)

3. Use tag-level aggregation to decide next topic:

   - If tag accuracy < 70%, serve more questions under that tag.
   - If > 90%, suggest related higher-level tags.

### Example Flow

> Student struggles with â€œChain Ruleâ€ â†’ more â€œComposite Differentiationâ€ questions â†’ if performance improves, move to â€œImplicit Differentiationâ€.

---

## ğŸ¯ 4. Analytics & Progress Tracking

### Metrics per Student

| Category                   | Example                           |
| -------------------------- | --------------------------------- |
| **Tag Mastery (%)**        | Aggregated accuracy on each tag   |
| **Avg Time per Question**  | Benchmark vs expected             |
| **Difficulty Progression** | Trendline of average difficulty   |
| **Consistency Index**      | Standard deviation of performance |
| **AI Engagement**          | Number of AI queries per topic    |

Dashboard view:

- Heatmap per tag (Red/Yellow/Green)
- Sparkline graphs for time-performance correlation
- Personalized â€œNext Stepsâ€ recommendations

---

## ğŸ’¬ 5. AI Tutor Integration

### Concept

A **topic-aware GPT assistant** embedded on lesson pages:

- Context-aware: It reads Unit + Chapter + Tag context.
- Can answer queries like â€œExplain why derivative of e^x is e^xâ€ or â€œGive a practice question on chain ruleâ€.
- Optionally fetches a random related question (`SELECT * FROM questions WHERE tags @> ['chain_rule'] ORDER BY RANDOM() LIMIT 1;`)

### Chat Modes

- **Doubt Solver**: Conceptual Q&A.
- **Question Discuss**: Explains a specific question from the bank.
- **Practice Advisor**: Suggests next 3 questions.
- **Meta-Coach Mode**: Encourages reflection (â€œWhich step confused you most?â€).

---

## ğŸ§© 6. User Experience Flow

### Lesson Page

- Concept â†’ Examples â†’ Practice Zone
- Practice Zone features:

  - â€œStart Practiceâ€ â†’ Loads questions dynamically
  - Timer auto-starts on render
  - â€œView Solutionâ€ button (reveals LaTeX solution)
  - â€œMark Correct / Incorrectâ€ â†’ Saves record
  - â€œDiscuss with AIâ€ â†’ Opens side chat window

### Dashboard Page

- Summary by Tag / Chapter / Unit
- â€œWeakest Tagsâ€ â†’ clickable to retry
- â€œRecommended Nextâ€ â†’ auto-generated from algorithm

---

## âš™ï¸ 7. Tech Infrastructure (at high level)

| Layer                  | Tools / Stack                                             |
| ---------------------- | --------------------------------------------------------- |
| **Frontend**           | Next.js + Shadcn/UI + Tailwind                            |
| **Backend**            | Supabase (Postgres + RLS)                                 |
| **AI Chat**            | OpenAI API (contextual embeddings for tag/topic)          |
| **Data Tracking**      | Supabase Edge Functions or Server Actions                 |
| **Analytics**          | Supabase dashboard or custom charts via Recharts          |
| **Question Rendering** | KaTeX/MathJax with â€œView Solutionâ€ toggle                 |
| **Adaptive Logic**     | Stored Procedures or external Python FastAPI microservice |

---

## ğŸ“ˆ 8. Phased Implementation

| Phase       | Focus                                                 | Output                                                      |
| ----------- | ----------------------------------------------------- | ----------------------------------------------------------- |
| **Phase 1** | Core structure + tagging + manual question navigation | Students can view lessons, questions, and self-mark answers |
| **Phase 2** | Performance tracking + RYG tag analytics              | Dashboard + progress tracking                               |
| **Phase 3** | Adaptive serving engine                               | Algorithm picks next question dynamically                   |
| **Phase 4** | AI integration                                        | Chatbot + â€œAsk AIâ€ contextual help                          |
| **Phase 5** | Recommendations + gamification                        | Suggested questions + streaks/XP                            |

---

## ğŸš€ 9. Future Enhancements

- **Gamified mastery badges** (Tag-level: â€œDifferentiation Proâ€)
- **Weekly review reports** emailed to students
- **Teacher dashboard** with per-student tag analytics
- **Concept map visualization** of tags (node graph)
- **Cross-tag AI analysis** (e.g., â€œStudent confuses Chain vs Product ruleâ€)

---

Would you like me to convert this strategy into a **visual architecture diagram** (like a system flow or ER + UX map) next? Itâ€™ll help when you start structuring Supabase tables and Next.js pages.
